<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Enviar Documentos — AgriConnect</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<div class="sidebar">…</div>

<div class="main">
  <h1>Enviar Documento para Verificação</h1>
  <p id="userInfo">Carregando sessão...</p>

  <div class="card">
    <form id="uploadForm" enctype="multipart/form-data">
      <label>Tipo de Documento:<br/>
        <select name="docType" required>
          <option value="ID_CARD">Bilhete de Identidade</option>
          <option value="LICENSE">Licença</option>
          <option value="OTHER">Outro</option>
        </select>
      </label><br/><br/>
      <label>Arquivo (PDF, JPG, PNG):<br/>
        <input type="file" name="file" accept=".pdf,.jpg,.jpeg,.png" required />
      </label><br/><br/>
      <button type="submit" class="btn btn-primary">Enviar</button>
    </form>
    <div id="uploadMsg"></div>
  </div>
</div>

<script type="module">
  import { getSession, renderUserInfo } from './js/dashboard.js';
  renderUserInfo('#userInfo');

  const form = document.getElementById('uploadForm');
  const msg = document.getElementById('uploadMsg');

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const fd = new FormData(form);
    const token = localStorage.getItem('pdc_auth_token');

    try {
      const res = await fetch('/api/documents/upload', {
        method: 'POST',
        headers: { Authorization: `Bearer ${token}` }, // ✅ include token
        body: fd
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || 'Falha no upload');
      msg.textContent = '✅ Documento enviado com sucesso! Status: ' + (data.status || 'pendente');
      form.reset();
    } catch (err) {
      msg.textContent = '❌ Erro: ' + err.message;
    }
  });
</script>
</body>
</html>
