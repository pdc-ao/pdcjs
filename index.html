<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AgriConnect Angola</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header class="site-header">
  <div class="container header-inner">
    <a class="brand" href="index.html">
      <span class="logo">A</span>
      <span class="brand-name">AgriConnect Angola</span>
    </a>
    <nav class="main-nav" id="mainNav">
      <a href="auth.html" id="authLink">Entrar / Registrar</a>
      <a href="about.html">Sobre N√≥s</a>
      <a href="contact.html">Contactos</a>
    </nav>
  </div>
</header>

<main>
  <section class="hero">
    <div class="container">
      <h1>Conectando Produtores e Consumidores em Angola</h1>
      <p class="lead">A maior plataforma digital agr√≠cola de Angola. Conecte-se com produtores, encontre armazenamento e transporte.</p>
      <div class="cta">
        <a class="btn btn-primary" href="auth.html">Come√ßar Agora</a>
        <a class="btn btn-outline" href="products.html">Ver Produtos</a>
      </div>
    </div>
  </section>

  <section class="features container">
    <h2>Como Funciona</h2>
    <div class="grid features-grid">
      <article class="feature-card"><div class="feature-emoji">üå±</div><h3>Produtores</h3><p>Venda produtos diretamente ao consumidor.</p></article>
      <article class="feature-card"><div class="feature-emoji">üõí</div><h3>Consumidores</h3><p>Compre produtos frescos e locais.</p></article>
      <article class="feature-card"><div class="feature-emoji">üè≠</div><h3>Armazenamento</h3><p>Encontre armaz√©ns e servi√ßos de armazenagem.</p></article>
      <article class="feature-card"><div class="feature-emoji">üöö</div><h3>Transporte</h3><p>Conecte-se com transportadores confi√°veis.</p></article>
    </div>
  </section>

  <section class="container">
    <h2>√öltimos Produtos</h2>
    <div id="homeProducts" class="grid cards-grid"></div>
    <div id="homeMsg" class="muted"></div>
    <!-- Optional search bar for logged-in users -->
    <div id="searchSection" style="margin-top:1rem; display:none;">
      <input type="text" id="searchInput" placeholder="Pesquisar produtos..." />
      <button id="searchBtn" class="btn btn-primary">Pesquisar</button>
    </div>
  </section>

  <section class="cta-section">
    <div class="container">
      <h2>Pronto para revolucionar o seu neg√≥cio agr√≠cola?</h2>
      <a class="btn btn-primary" href="auth.html">Cadastre-se Gratuitamente</a>
    </div>
  </section>
</main>

<!-- ... about, contact, FAQ, social sections unchanged ... -->

<footer class="site-footer">
  <div class="container">
    <p>¬© <span id="yearHome"></span> AgriConnect Angola ‚Äî Todos os direitos reservados.</p>
  </div>
</footer>

<script src="js/api-bridge.js"></script>
<script src="js/app.js"></script>
<script>
  // year
  document.getElementById('yearHome').innerText = new Date().getFullYear();

  // load latest products (public preview)
  async function loadProducts(query) {
    const container = document.getElementById('homeProducts');
    const msg = document.getElementById('homeMsg');
    container.innerHTML = '<div class="loading">Carregando...</div>';
    try {
      const token = localStorage.getItem('token');
      const headers = token ? { Authorization: `Bearer ${token}` } : {};
      const url = query
        ? `/api/products?page=1&limit=4&q=${encodeURIComponent(query)}`
        : `/api/products?page=1&limit=4`;

      const res = await fetch(url, { headers });
      const data = await res.json();
      const products = data.data || [];
      container.innerHTML = '';
      if (!products.length) {
        msg.textContent = 'Nenhum produto dispon√≠vel no momento.';
        return;
      }
      products.forEach(p => container.appendChild(renderProductCard(p)));
    } catch (e) {
      console.error('Erro carregando produtos:', e);
      container.innerHTML = '';
      msg.textContent = 'Erro carregando produtos (funcional offline).';
    }
  }

  loadProducts();

  // enable search only if logged in
  const token = localStorage.getItem('token');
  if (token) {
    document.getElementById('searchSection').style.display = 'block';
    document.getElementById('searchBtn').addEventListener('click', () => {
      const q = document.getElementById('searchInput').value.trim();
      if (q) loadProducts(q);
    });
  }

  // contact form handler (unchanged)
  document.getElementById('contactForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const form = e.target;
    const msg = document.getElementById('contactMsg');
    msg.textContent = '';

    const data = Object.fromEntries(new FormData(form));
    try {
      await fetchJSON('/api/messages', {
        method: 'POST',
        body: JSON.stringify({
          name: data.name,
          email: data.email,
          phone: data.phone || null,
          subject: data.subject,
          message: data.message
        })
      });

      showToast('Mensagem enviada com sucesso!', 'success');
      msg.textContent = 'Obrigado pelo contacto. Responderemos em breve.';
      form.reset();
    } catch (err) {
      console.error('Erro ao enviar mensagem:', err);
      showToast('Erro ao enviar mensagem', 'error');
      msg.textContent = 'Ocorreu um erro. Tente novamente mais tarde.';
    }
  });
</script>
</body>
</html>
